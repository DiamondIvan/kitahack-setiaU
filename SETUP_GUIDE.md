# SetiaU - Complete Setup & Deployment Guide

## ğŸš€ Quick Start

SetiaU is an agentic AI secretary for student organizations and NGOs. This guide covers local setup, Firebase configuration, and deployment.

---

## âœ… Prerequisites

- Flutter SDK 3.11+
- Node.js 20+
- Firebase CLI (`npm install -g firebase-tools`)
- Google Cloud Project with Gemini API enabled
- Google Workspace API credentials
- A Firebase project

---

## ğŸ“¦ Part 1: Local Development Setup

### 1.1 Clone & Dependencies

```bash
cd c:\Users\User\kitahack-setiaU
flutter pub get
```

### 1.2 Configure Firebase

Your Firebase configuration is already in:
- `lib/firebase_options.dart` - Auto-generated by Firebase CLI

To regenerate if needed:
```bash
flutter pub global activate flutterfire_cli
flutterfire configure
```

### 1.3 Add Google Sign-In Keys

**For Android** (`android/app/build.gradle.kts`):
```gradle
dependencies {
    implementation 'com.google.gms:google-services:4.4.0'
}
```

**For iOS** (`ios/Runner/GoogleService-Info.plist`):
- Download from Firebase Console
- Add to `ios/Runner/` directory

### 1.4 Configure Gemini API

1. Go to [Google AI Studio](https://aistudio.google.com/app/apikey)
2. Create an API key
3. Add to your environment or store securely in Firebase Remote Config
4. Update `lib/services/gemini_service.dart`:

```dart
final geminiService = GeminiService(apiKey: 'YOUR_GEMINI_API_KEY');
```

---

## ğŸ”§ Part 2: Firebase Cloud Setup

### 2.1 Initialize Firebase Project

```bash
firebase login
firebase init
```

Select features:
- âœ… Firestore Database
- âœ… Cloud Functions
- âœ… Authentication
- âœ… Hosting (optional)

### 2.2 Copy Firebase Config

Ensure these files exist:
- `.firebaserc` - Project aliases
- `firebase.json` - Configuration

### 2.3 Set Gemini API Key

Store securely in Firebase (never hardcode):

```bash
firebase functions:config:set gemini.api_key="YOUR_GEMINI_API_KEY"
firebase functions:config:set google.project_id="YOUR_GCP_PROJECT_ID"
```

---

## â˜ï¸ Part 3: Cloud Functions Deployment

Cloud Functions handle:
- Calendar event creation
- Email sending
- Google Sheets updates
- Document generation
- Transcript processing

### 3.1 Deploy Functions

```bash
cd functions
npm install
cd ..
firebase deploy --only functions
```

Expected output:
```
âœ”  Deploy complete!
Function URL: https://us-central1-YOUR-PROJECT.cloudfunctions.net/
```

### 3.2 Available Functions

| Function | Trigger | Purpose |
|----------|---------|---------|
| `executeCalendarAction` | HTTP (onCall) | Create calendar events |
| `executeEmailAction` | HTTP (onCall) | Send emails via Gmail |
| `executeSheetsAction` | HTTP (onCall) | Update Google Sheets |
| `executeDocsAction` | HTTP (onCall) | Create Google Docs |
| `processTranscript` | Firestore (onUpdate) | Extract tasks from transcript |
| `cleanupExpiredActions` | Scheduled (24h) | Clean old action records |

---

## ğŸ” Part 4: Google Workspace Integration

### 4.1 Enable Required APIs

In Google Cloud Console:
1. **Calendar API** - For meeting scheduling
2. **Gmail API** - For email automation
3. **Google Docs API** - For proposal documents
4. **Google Sheets API** - For budget tracking
5. **Google Drive API** - For file management

```bash
gcloud services enable \
  calendar-json.googleapis.com \
  gmail.googleapis.com \
  docs.google.com \
  sheets.googleapis.com \
  drive.googleapis.com
```

### 4.2 Service Account Setup

For backend API access:

```bash
gcloud iam service-accounts create setiau-service \
  --display-name "SetiaU Service Account"

gcloud iam service-accounts keys create \
  functions/setiau-service-key.json \
  --iam-account=setiau-service@YOUR_PROJECT.iam.gserviceaccount.com
```

### 4.3 Domain-Wide Delegation

To access user calendars/emails:

1. Go to Google Workspace Admin â†’ Security â†’ API Controls
2. Grant domain-wide delegation to service account
3. Scopes to grant:
   - `https://www.googleapis.com/auth/calendar`
   - `https://www.googleapis.com/auth/gmail.send`
   - `https://www.googleapis.com/auth/drive`
   - `https://www.googleapis.com/auth/spreadsheets`
   - `https://www.googleapis.com/auth/documents`

---

## ğŸ—„ï¸ Part 5: Firestore Database Schema

Automatic collection structure:

### Collections Created:

```
firestore/
â”œâ”€â”€ meetings/
â”‚   â”œâ”€â”€ meeting_001
â”‚   â”‚   â”œâ”€â”€ organizationId: string
â”‚   â”‚   â”œâ”€â”€ title: string
â”‚   â”‚   â”œâ”€â”€ startTime: timestamp
â”‚   â”‚   â”œâ”€â”€ attendees: array
â”‚   â”‚   â”œâ”€â”€ transcriptUrl: string (optional)
â”‚   â”‚   â””â”€â”€ status: string ('draft', 'completed', 'ongoing')
â”‚
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ task_001
â”‚   â”‚   â”œâ”€â”€ meetingId: string
â”‚   â”‚   â”œâ”€â”€ title: string
â”‚   â”‚   â”œâ”€â”€ assignedTo: string
â”‚   â”‚   â”œâ”€â”€ dueDate: timestamp
â”‚   â”‚   â”œâ”€â”€ priority: string ('high', 'medium', 'low')
â”‚   â”‚   â””â”€â”€ status: string ('pending', 'approved', 'completed')
â”‚
â”œâ”€â”€ actions/
â”‚   â”œâ”€â”€ action_001
â”‚   â”‚   â”œâ”€â”€ taskId: string
â”‚   â”‚   â”œâ”€â”€ actionType: string ('calendar', 'email', 'sheets', 'docs')
â”‚   â”‚   â”œâ”€â”€ payload: object
â”‚   â”‚   â”œâ”€â”€ status: string ('pending', 'approved', 'executed', 'rejected')
â”‚   â”‚   â””â”€â”€ constraints: array
â”‚
â”œâ”€â”€ budgets/
â”‚   â”œâ”€â”€ budget_001
â”‚   â”‚   â”œâ”€â”€ organizationId: string
â”‚   â”‚   â”œâ”€â”€ category: string
â”‚   â”‚   â”œâ”€â”€ allocated: number
â”‚   â”‚   â”œâ”€â”€ spent: number
â”‚   â”‚   â””â”€â”€ currency: string
â”‚
â””â”€â”€ organizations/
    â”œâ”€â”€ org_001
    â”‚   â”œâ”€â”€ name: string
    â”‚   â”œâ”€â”€ members: array
    â”‚   â”œâ”€â”€ admin: string (user ID)
    â”‚   â””â”€â”€ settings: object
```

### Firestore Rules (firebase.json)

```json
{
  "rules": {
    "users/{uid}": {
      ".read": "request.auth.uid == uid",
      ".write": "request.auth.uid == uid"
    },
    "organizations/{orgId}": {
      ".read": "request.auth != null && root.child('organizations').child(orgId).child('members').hasChild(request.auth.uid)",
      ".write": "request.auth != null && root.child('organizations').child(orgId).child('admin').val() == request.auth.uid"
    },
    "meetings/{meetingId}": {
      ".read": "request.auth != null",
      ".write": "request.auth != null"
    },
    "actions/{actionId}": {
      ".read": "request.auth != null",
      ".write": "request.auth != null"
    }
  }
}
```

---

## ğŸ“± Part 6: Running the App

### Local Testing

```bash
# Run on Android emulator
flutter run -d emulator-5554

# Run on iOS simulator
flutter run -d macos

# Run on physical device
flutter run
```

### Testing Workflow

1. **Login** - Google Sign-In
2. **Meeting Mode** - Simulate recording â†’ Extract tasks
3. **Dashboard** - Review pending actions â†’ Approve/Reject
4. **Validation** - Check Firebase Firestore for saved data

---

## ğŸ”„ Part 7: Gemini Integration

### How Task Extraction Works

1. **Recording Ends** â†’ Transcript sent to Gemini 2.0 Pro
2. **AI Processing** â†’ Extract tasks, deadlines, assignees
3. **Constraint Detection** â†’ Check conflicts
4. **Human Review** â†’ User approves in Dashboard
5. **Action Generation** â†’ Create Calendar/Email/Sheets actions
6. **Execution** â†’ Cloud Functions execute via Google APIs

### Prompt Engineering

Gemini prompts are in `lib/services/gemini_service.dart`:

```dart
Future<List<Task>> extractTasksFromTranscript(...)
Future<List<String>> detectConstraints(...)
Future<String> proposeAlternativeSolution(...)
```

To customize behavior, modify the prompt templates.

---

## ğŸš¢ Part 8: Production Deployment

### 8.1 Flutter Web/App Distribution

```bash
# Build Android APK
flutter build apk --release

# Build iOS app
flutter build ios --release

# Deploy to Play Store / App Store
# (Use your distribution process)
```

### 8.2 Cloud Functions Production

```bash
# Check current functions
firebase deploy --only functions --dry-run

# Deploy with monitoring
firebase deploy --only functions --debug

# View logs
firebase functions:log --limit 100
```

### 8.3 Database Backup

```bash
# Scheduled backups via GCP Console
# Or manual export:
gcloud firestore export gs://YOUR_BUCKET/backups/backup-$(date +%Y%m%d)
```

---

## ğŸ“Š Part 9: Monitoring & Debugging

### View Logs

```bash
# Cloud Functions logs
firebase functions:log

# Firestore operations
gcloud firestore query log

# Real-time debugging
firebase emulators:start --only firestore,functions
```

### Common Issues

| Issue | Solution |
|-------|----------|
| "Permission denied" on Firestore | Check Firestore rules - ensure user is authenticated |
| "Invalid API key" | Verify Gemini API key in functions config |
| Calendar events not created | Enable Google Calendar API in GCP Console |
| Cloud Functions timeout | Increase timeout in `firebase.json` |

---

## ğŸ” Part 10: Security Checklist

- âœ… Google Sign-In enabled with OAuth 2.0
- âœ… Firebase Auth rules restrict to authenticated users
- âœ… Firestore rules enforce organization membership
- âœ… API keys rotated monthly
- âœ… Sensitive config stored in Functions Config (not git)
- âœ… All API calls signed with verified auth tokens
- âœ… Action logs immutable (append-only)
- âœ… Gemini API calls limited to organization data only

---

## ğŸ“š Additional Resources

- [Firebase Documentation](https://firebase.google.com/docs)
- [Gemini API Guide](https://ai.google.dev/docs)
- [Google Workspace API](https://developers.google.com/workspace/guides)
- [Flutter Docs](https://flutter.dev/docs)

---

## ğŸ¯ Next Steps After Deployment

1. **Test End-to-End**: Recording â†’ Task extraction â†’ Approval â†’ Execution
2. **Integrate Gemini 2.0 Pro**: Add JSON parsing for task extraction
3. **Complete Google Workspace Setup**: Test calendar/email/sheets actions
4. **Multi-organization Support**: Add organization switching
5. **Advanced Features**: Docs auto-generation, budget forecasting, role recommendations

---

**SetiaU v3.0 - The Agentic Secretary for Impact Organizations**

Built with â¤ï¸ for KitaHack 2026
